"use strict";var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");Object.defineProperty(exports, "__esModule", { value: true });exports.initializeAssetContentDelivery = initializeAssetContentDelivery;exports.initializeRootContentRendering = initializeRootContentRendering;
var serviceConfig = _interopRequireWildcard(require("../../configuration/configuration.js"));
var _server = require("../../utility/server.js");
var assetContentDeliveryGraph = _interopRequireWildcard(require("../../../resource/assetContentDelivery.graph.json"));
var rootContentRenderingGraph = _interopRequireWildcard(require("../../../resource/rootContentRendering.graph.json"));
var _graphInitialization = require("../../utility/graphInitialization.js");

var _traverseMiddlewareGraph = require("./middleware/traverseMiddlewareGraph.js");
var _graphReferenceContext = require("./graphReferenceContext.js");













async function initializeAssetContentDelivery(
{ targetProjectConfig, entrypointKey, port = serviceConfig.contentDelivery.port },
{ memgraph = {} } = {})
{

  let { configuredGraph, service: graphDbService } = await (0, _graphInitialization.initializeGraph)({
    contextData: { targetProjectConfig },
    graphDataArray: [assetContentDeliveryGraph],
    host: memgraph === null || memgraph === void 0 ? void 0 : memgraph.host,
    port: memgraph === null || memgraph === void 0 ? void 0 : memgraph.port });



  let curriedMiddlewareFunctionReferenceList = (0, _graphReferenceContext.middlewareFunctionReferenceList)({ targetProjectConfig, configuredGraph }),
  curriedConditionFunctionReferenceList = (0, _graphReferenceContext.conditionFunctionReferenceList)({ targetProjectConfig, configuredGraph });
  let middlewareArray = [
  await (0, _traverseMiddlewareGraph.graphMiddlewareImmediatelyExecute)({
    entrypointKey: '293097b9-3522-4f2b-b557-8380ff3e96e3',
    configuredGraph,
    referenceList: middlewareContext => ({
      functionReferenceContext: Object.assign(curriedMiddlewareFunctionReferenceList({ middlewareContext }), curriedConditionFunctionReferenceList({ middlewareContext })) }) })];









  let serverService = await (0, _server.createHttpServer)({ serviceName: `${serviceConfig.contentDelivery.serviceName}`, port, middlewareArray });

  return { service: [serverService, graphDbService] };
}











async function initializeRootContentRendering(
{ targetProjectConfig, entrypointKey, port = serviceConfig.contentRendering.port },
{ memgraph = {} } = {})
{

  let { configuredGraph, service: graphDbService } = await (0, _graphInitialization.initializeGraph)({
    contextData: { targetProjectConfig },
    graphDataArray: [rootContentRenderingGraph],
    host: memgraph === null || memgraph === void 0 ? void 0 : memgraph.host,
    port: memgraph === null || memgraph === void 0 ? void 0 : memgraph.port });



  let curriedMiddlewareFunctionReferenceList = (0, _graphReferenceContext.middlewareFunctionReferenceList)({ targetProjectConfig, configuredGraph }),
  curriedConditionFunctionReferenceList = (0, _graphReferenceContext.conditionFunctionReferenceList)({ targetProjectConfig, configuredGraph });
  let middlewareArray = [
  await (0, _traverseMiddlewareGraph.graphMiddlewareImmediatelyExecute)({
    entrypointKey: '928efj94-29034jg90248-g2390jg823',
    configuredGraph,
    referenceList: middlewareContext => ({
      functionReferenceContext: Object.assign(curriedMiddlewareFunctionReferenceList({ middlewareContext }), curriedConditionFunctionReferenceList({ middlewareContext })) }) })];









  let serverService = await (0, _server.createHttpServer)({ serviceName: `${serviceConfig.contentRendering.serviceName}`, port, middlewareArray });

  return { service: [serverService, graphDbService] };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NvdXJjZS9jbGllbnRJbnRlcmZhY2UvUkVTVC9pbmRleC5qcyJdLCJuYW1lcyI6WyJpbml0aWFsaXplQXNzZXRDb250ZW50RGVsaXZlcnkiLCJ0YXJnZXRQcm9qZWN0Q29uZmlnIiwiZW50cnlwb2ludEtleSIsInBvcnQiLCJzZXJ2aWNlQ29uZmlnIiwiY29udGVudERlbGl2ZXJ5IiwibWVtZ3JhcGgiLCJjb25maWd1cmVkR3JhcGgiLCJzZXJ2aWNlIiwiZ3JhcGhEYlNlcnZpY2UiLCJjb250ZXh0RGF0YSIsImdyYXBoRGF0YUFycmF5IiwiYXNzZXRDb250ZW50RGVsaXZlcnlHcmFwaCIsImhvc3QiLCJjdXJyaWVkTWlkZGxld2FyZUZ1bmN0aW9uUmVmZXJlbmNlTGlzdCIsImN1cnJpZWRDb25kaXRpb25GdW5jdGlvblJlZmVyZW5jZUxpc3QiLCJtaWRkbGV3YXJlQXJyYXkiLCJyZWZlcmVuY2VMaXN0IiwibWlkZGxld2FyZUNvbnRleHQiLCJmdW5jdGlvblJlZmVyZW5jZUNvbnRleHQiLCJPYmplY3QiLCJhc3NpZ24iLCJzZXJ2ZXJTZXJ2aWNlIiwic2VydmljZU5hbWUiLCJpbml0aWFsaXplUm9vdENvbnRlbnRSZW5kZXJpbmciLCJjb250ZW50UmVuZGVyaW5nIiwicm9vdENvbnRlbnRSZW5kZXJpbmdHcmFwaCJdLCJtYXBwaW5ncyI6IjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7Ozs7Ozs7Ozs7Ozs7QUFjTyxlQUFlQSw4QkFBZjtBQUNMLEVBQUVDLG1CQUFGLEVBQXVCQyxhQUF2QixFQUFzQ0MsSUFBSSxHQUFHQyxhQUFhLENBQUNDLGVBQWQsQ0FBOEJGLElBQTNFLEVBREs7QUFFTCxFQUFFRyxRQUFRLEdBQUcsRUFBYixLQUFrRSxFQUY3RDtBQUdMOztBQUVBLE1BQUksRUFBRUMsZUFBRixFQUFtQkMsT0FBTyxFQUFFQyxjQUE1QixLQUErQyxNQUFNLDBDQUFnQjtBQUN2RUMsSUFBQUEsV0FBVyxFQUFF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LEVBQXNFYSxlQUF0RSxFQUFqQixDQUExQjs7QUFFQSxTQUFPLEVBQUVSLE9BQU8sRUFBRSxDQUFDYyxhQUFELEVBQWdCYixjQUFoQixDQUFYLEVBQVA7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBmaWxlc3lzdGVtIGZyb20gJ2ZzJ1xuaW1wb3J0ICogYXMgc2VydmljZUNvbmZpZyBmcm9tICcuLi8uLi9jb25maWd1cmF0aW9uL2NvbmZpZ3VyYXRpb24uanMnXG5pbXBvcnQgeyBjcmVhdGVIdHRwU2VydmVyIH0gZnJvbSAnLi4vLi4vdXRpbGl0eS9zZXJ2ZXIuanMnXG5pbXBvcnQgKiBhcyBhc3NldENvbnRlbnREZWxpdmVyeUdyYXBoIGZyb20gJy4uLy4uLy4uL3Jlc291cmNlL2Fzc2V0Q29udGVudERlbGl2ZXJ5LmdyYXBoLmpzb24nXG5pbXBvcnQgKiBhcyByb290Q29udGVudFJlbmRlcmluZ0dyYXBoIGZyb20gJy4uLy4uLy4uL3Jlc291cmNlL3Jvb3RDb250ZW50UmVuZGVyaW5nLmdyYXBoLmpzb24nXG5pbXBvcnQgeyBpbml0aWFsaXplR3JhcGggfSBmcm9tICcuLi8uLi91dGlsaXR5L2dyYXBoSW5pdGlhbGl6YXRpb24uanMnXG5pbXBvcnQgKiBhcyBncmFwaEV2YWx1YXRpb25GdW5jdGlvbiBmcm9tICcuL2dyYXBoRXZhbHVhdGlvbkZ1bmN0aW9uLmpzJ1xuaW1wb3J0IHsgZ3JhcGhNaWRkbGV3YXJlSW1tZWRpYXRlbHlFeGVjdXRlIH0gZnJvbSAnLi9taWRkbGV3YXJlL3RyYXZlcnNlTWlkZGxld2FyZUdyYXBoLmpzJ1xuaW1wb3J0IHsgbWlkZGxld2FyZUZ1bmN0aW9uUmVmZXJlbmNlTGlzdCwgY29uZGl0aW9uRnVuY3Rpb25SZWZlcmVuY2VMaXN0IH0gZnJvbSAnLi9ncmFwaFJlZmVyZW5jZUNvbnRleHQuanMnXG5cbi8vIFRPRE86IFVzZSBsb2dnaW5nIHBsdWdpbjogZm9yIGRlYnVnIGFsbG93IHRvIGxvZyBtaWRkbGV3YXJlcyB0cmF2ZXJzZWQsIHRocm91Z2ggYXBwbHlpbmcgbG9ncyBpbiBncmFwaFRyYXZlcnNhbCBhbmQgaW1wbGVtZW50YXRpb24gZS5nLiBpbW1lZGlhdGVseUV4ZWN1dGVNaWRkbGV3YXJlLlxuXG4vKiogXG5AcGFyYW0jMSAgc2VydmljZSBjb25maWd1cmF0aW9uc1xuQHBhcmFtIzIgIGRlcGVuZGVuY3kgc2VydmljZXMgY29uZmlndXJhdGlvbnNcblxuQXNzZXRzLCBkaWZmZXJlbnQgY29tcG9uZW50cyBvZiB0aGUgc2l0ZSwgYW5kIHN0YXRpYyBmaWxlcywgaW50ZW5kZWQgdG8gYmUgcmVxdWVzdGVkIGZyb20gYSBzdWJkb21haW4uXG4gIC0gU2VydmVzIHN0YXRpYyBmaWxlc1xuICAtIFJlbmRlcmVkIGZpbGVzXG5cbiAgQXJjaGl0ZWN0dXJlOiBSRVNUICsgQ3VzdG9tIGNvbmNlcHRzLCBQcm90b2NvbDogSFRUUFxuKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBpbml0aWFsaXplQXNzZXRDb250ZW50RGVsaXZlcnkoXG4gIHsgdGFyZ2V0UHJvamVjdENvbmZpZywgZW50cnlwb2ludEtleSwgcG9ydCA9IHNlcnZpY2VDb25maWcuY29udGVudERlbGl2ZXJ5LnBvcnQgfSxcbiAgeyBtZW1ncmFwaCA9IHt9IH06IHsgbWVtZ3JhcGg6IHsgcG9ydDogTnVtYmVyLCBob3N0OiBTdHJpbmcgfSB9ID0ge30sXG4pIHtcbiAgLy8gQ3JlYXRlIGEgZ3JwYWggaW5zdGFuY2Ugd2l0aCBtaWRkbGV3YXJlIHJlZmVyZW5jZXMgYW5kIGxvYWQgZ3JhcGggZGF0YS5cbiAgbGV0IHsgY29uZmlndXJlZEdyYXBoLCBzZXJ2aWNlOiBncmFwaERiU2VydmljZSB9ID0gYXdhaXQgaW5pdGlhbGl6ZUdyYXBoKHtcbiAgICBjb250ZXh0RGF0YTogeyB0YXJnZXRQcm9qZWN0Q29uZmlnIH0sXG4gICAgZ3JhcGhEYXRhQXJyYXk6IFthc3NldENvbnRlbnREZWxpdmVyeUdyYXBoXSxcbiAgICBob3N0OiBtZW1ncmFwaD8uaG9zdCxcbiAgICBwb3J0OiBtZW1ncmFwaD8ucG9ydCxcbiAgfSkgLy8gcmV0dXJucyBhIGNvbmZpZ3VyZWRHcmFwaCBlbGVtZW50LlxuXG4gIC8vIHNldCBzZXJ2ZXIgbWlkZGxld2FyZXNcbiAgbGV0IGN1cnJpZWRNaWRkbGV3YXJlRnVuY3Rpb25SZWZlcmVuY2VMaXN0ID0gbWlkZGxld2FyZUZ1bmN0aW9uUmVmZXJlbmNlTGlzdCh7IHRhcmdldFByb2plY3RDb25maWcsIGNvbmZpZ3VyZWRHcmFwaCB9KSxcbiAgICBjdXJyaWVkQ29uZGl0aW9uRnVuY3Rpb25SZWZlcmVuY2VMaXN0ID0gY29uZGl0aW9uRnVuY3Rpb25SZWZlcmVuY2VMaXN0KHsgdGFyZ2V0UHJvamVjdENvbmZpZywgY29uZmlndXJlZEdyYXBoIH0pXG4gIGxldCBtaWRkbGV3YXJlQXJyYXkgPSBbXG4gICAgYXdhaXQgZ3JhcGhNaWRkbGV3YXJlSW1tZWRpYXRlbHlFeGVjdXRlKHtcbiAgICAgIGVudHJ5cG9pbnRLZXk6ICcyOTMwOTdiOS0zNTIyLTRmMmItYjU1Ny04MzgwZmYzZTk2ZTMnLFxuICAgICAgY29uZmlndXJlZEdyYXBoLFxuICAgICAgcmVmZXJlbmNlTGlzdDogbWlkZGxld2FyZUNvbnRleHQgPT4gKHtcbiAgICAgICAgZnVuY3Rpb25SZWZlcmVuY2VDb250ZXh0OiBPYmplY3QuYXNzaWduKGN1cnJpZWRNaWRkbGV3YXJlRnVuY3Rpb25SZWZlcmVuY2VMaXN0KHsgbWlkZGxld2FyZUNvbnRleHQgfSksIGN1cnJpZWRDb25kaXRpb25GdW5jdGlvblJlZmVyZW5jZUxpc3QoeyBtaWRkbGV3YXJlQ29udGV4dCB9KSksXG4gICAgICB9KSxcbiAgICB9KSxcbiAgICAvLyBhc3luYyAoY29udGV4dCwgbmV4dCkgPT4ge1xuICAgIC8vICAgY29uc29sZS5sb2coJ0xhc3QgTWlkZGxld2FyZSByZWFjaGVkLicpXG4gICAgLy8gICBhd2FpdCBuZXh0KClcbiAgICAvLyB9LFxuICBdXG5cbiAgLy8gY3JlYXRlIGh0dHAgc2VydmVyXG4gIGxldCBzZXJ2ZXJTZXJ2aWNlID0gYXdhaXQgY3JlYXRlSHR0cFNlcnZlcih7IHNlcnZpY2VOYW1lOiBgJHtzZXJ2aWNlQ29uZmlnLmNvbnRlbnREZWxpdmVyeS5zZXJ2aWNlTmFtZX1gLCBwb3J0LCBtaWRkbGV3YXJlQXJyYXkgfSlcblxuICByZXR1cm4geyBzZXJ2aWNlOiBbc2VydmVyU2VydmljZSwgZ3JhcGhEYlNlcnZpY2VdIH1cbn1cblxuLyoqIFxuQHBhcmFtIzEgIHNlcnZpY2UgY29uZmlndXJhdGlvbnNcbkBwYXJhbSMyICBkZXBlbmRlbmN5IHNlcnZpY2VzIGNvbmZpZ3VyYXRpb25zXG5cblJvb3QgZG9tYWluIGNvbnRlbnQgTWFpbmx5IHVzZXIgaW50ZXJmYWNlIHJlbGF0ZWRcbiAqICAtIHNlcnZlcnMgdGVtcGxhdGUgcmVuZGVyZWQgZmlsZXMgZm9yIHdlYmFwcCBpbnRlcmZhY2UgKG1hbmlwdWxhdGVkIGZpbGVzIHVzaW5nIG5vZGVqcyByZW5kZXJpbmcpLlxuICogIC0gc2VydmVzIHNvbWUgc3RhdGljIGZpbGVzIHJlcXVpcmVkIGluIHRoZSByb290IGRvbWFpbi5cbiAqIFxuIEFyY2hpdGVjdHVyZTogUkVTVCArIEN1c3RvbSBjb25jZXB0cywgUHJvdG9jb2w6IEhUVFBcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGluaXRpYWxpemVSb290Q29udGVudFJlbmRlcmluZyhcbiAgeyB0YXJnZXRQcm9qZWN0Q29uZmlnLCBlbnRyeXBvaW50S2V5LCBwb3J0ID0gc2VydmljZUNvbmZpZy5jb250ZW50UmVuZGVyaW5nLnBvcnQgfSxcbiAgeyBtZW1ncmFwaCA9IHt9IH06IHsgbWVtZ3JhcGg6IHsgcG9ydDogTnVtYmVyLCBob3N0OiBTdHJpbmcgfSB9ID0ge30sXG4pIHtcbiAgLy8gQ3JlYXRlIGEgZ3JwYWggaW5zdGFuY2Ugd2l0aCBtaWRkbGV3YXJlIHJlZmVyZW5jZXMgYW5kIGxvYWQgZ3JhcGggZGF0YS5cbiAgbGV0IHsgY29uZmlndXJlZEdyYXBoLCBzZXJ2aWNlOiBncmFwaERiU2VydmljZSB9ID0gYXdhaXQgaW5pdGlhbGl6ZUdyYXBoKHtcbiAgICBjb250ZXh0RGF0YTogeyB0YXJnZXRQcm9qZWN0Q29uZmlnIH0sXG4gICAgZ3JhcGhEYXRhQXJyYXk6IFtyb290Q29udGVudFJlbmRlcmluZ0dyYXBoXSxcbiAgICBob3N0OiBtZW1ncmFwaD8uaG9zdCxcbiAgICBwb3J0OiBtZW1ncmFwaD8ucG9ydCxcbiAgfSkgLy8gcmV0dXJucyBhIGNvbmZpZ3VyZWRHcmFwaCBlbGVtZW50LlxuXG4gIC8vIHNldCBzZXJ2ZXIgbWlkZGxld2FyZXNcbiAgbGV0IGN1cnJpZWRNaWRkbGV3YXJlRnVuY3Rpb25SZWZlcmVuY2VMaXN0ID0gbWlkZGxld2FyZUZ1bmN0aW9uUmVmZXJlbmNlTGlzdCh7IHRhcmdldFByb2plY3RDb25maWcsIGNvbmZpZ3VyZWRHcmFwaCB9KSxcbiAgICBjdXJyaWVkQ29uZGl0aW9uRnVuY3Rpb25SZWZlcmVuY2VMaXN0ID0gY29uZGl0aW9uRnVuY3Rpb25SZWZlcmVuY2VMaXN0KHsgdGFyZ2V0UHJvamVjdENvbmZpZywgY29uZmlndXJlZEdyYXBoIH0pXG4gIGxldCBtaWRkbGV3YXJlQXJyYXkgPSBbXG4gICAgYXdhaXQgZ3JhcGhNaWRkbGV3YXJlSW1tZWRpYXRlbHlFeGVjdXRlKHtcbiAgICAgIGVudHJ5cG9pbnRLZXk6ICc5MjhlZmo5NC0yOTAzNGpnOTAyNDgtZzIzOTBqZzgyMycsXG4gICAgICBjb25maWd1cmVkR3JhcGgsXG4gICAgICByZWZlcmVuY2VMaXN0OiBtaWRkbGV3YXJlQ29udGV4dCA9PiAoe1xuICAgICAgICBmdW5jdGlvblJlZmVyZW5jZUNvbnRleHQ6IE9iamVjdC5hc3NpZ24oY3VycmllZE1pZGRsZXdhcmVGdW5jdGlvblJlZmVyZW5jZUxpc3QoeyBtaWRkbGV3YXJlQ29udGV4dCB9KSwgY3VycmllZENvbmRpdGlvbkZ1bmN0aW9uUmVmZXJlbmNlTGlzdCh7IG1pZGRsZXdhcmVDb250ZXh0IH0pKSxcbiAgICAgIH0pLFxuICAgIH0pLFxuICAgIC8vIGFzeW5jIChjb250ZXh0LCBuZXh0KSA9PiB7XG4gICAgLy8gICBjb25zb2xlLmxvZygnTGFzdCBNaWRkbGV3YXJlIHJlYWNoZWQuJylcbiAgICAvLyAgIGF3YWl0IG5leHQoKVxuICAgIC8vIH0sXG4gIF1cblxuICAvLyBjcmVhdGUgaHR0cCBzZXJ2ZXJcbiAgbGV0IHNlcnZlclNlcnZpY2UgPSBhd2FpdCBjcmVhdGVIdHRwU2VydmVyKHsgc2VydmljZU5hbWU6IGAke3NlcnZpY2VDb25maWcuY29udGVudFJlbmRlcmluZy5zZXJ2aWNlTmFtZX1gLCBwb3J0LCBtaWRkbGV3YXJlQXJyYXkgfSlcblxuICByZXR1cm4geyBzZXJ2aWNlOiBbc2VydmVyU2VydmljZSwgZ3JhcGhEYlNlcnZpY2VdIH1cbn1cbiJdfQ==